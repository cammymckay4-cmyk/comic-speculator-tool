# ComicScoutUK System Architecture
**Version:** 1.0  
**Last Updated:** August 2025

## üèóÔ∏è Overview
ComicScoutUK follows a decoupled architecture pattern, separating concerns between data management, business logic, and presentation layers. This design ensures maximum flexibility, scalability, and maintainability.

## üéØ Architectural Principles

### 1. Decoupled Design
* **Backend:** Standalone REST API handling all business logic
* **Frontend:** Interchangeable client applications
* **Database:** Managed PostgreSQL via Supabase
* **External Services:** Isolated integration points

### 2. API-First Approach
* All functionality exposed through REST endpoints
* JSON-based communication
* Comprehensive API documentation
* Version-controlled API contracts

### 3. Scalable Infrastructure
* Stateless backend services
* Database connection pooling
* Cacheable responses
* Horizontal scaling capability

### 4. Security by Design
* JWT-based authentication
* Role-based access control
* Input validation and sanitization
* Rate limiting and abuse prevention

## üîß Technology Stack

### Backend Services
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          Backend API                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Runtime: Node.js 18+                                          ‚îÇ
‚îÇ ‚Ä¢ Language: TypeScript 5+                                       ‚îÇ
‚îÇ ‚Ä¢ Framework: Express.js                                         ‚îÇ
‚îÇ ‚Ä¢ Validation: Joi/Zod                                           ‚îÇ
‚îÇ ‚Ä¢ Authentication: Supabase Auth                                 ‚îÇ
‚îÇ ‚Ä¢ ORM: Supabase-js Client                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


### Database Layer
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Database Layer                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Database: PostgreSQL 15+                                      ‚îÇ
‚îÇ ‚Ä¢ Platform: Supabase                                            ‚îÇ
‚îÇ ‚Ä¢ Features: RLS, Real-time subscriptions, Auth integration      ‚îÇ
‚îÇ ‚Ä¢ Migrations: Supabase CLI                                      ‚îÇ
‚îÇ ‚Ä¢ Backup: Automated daily snapshots                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


### External Integrations
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     External Services                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ eBay API: Trading & Finding APIs                              ‚îÇ
‚îÇ ‚Ä¢ GoCollect API: Fair Market Value data                         ‚îÇ
‚îÇ ‚Ä¢ Resend API: Transactional email delivery                      ‚îÇ
‚îÇ ‚Ä¢ Google Maps API: LCS location services                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


## üìä System Components

### 1. API Gateway Layer
// Express.js application structure
app/
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts          // JWT validation
‚îÇ   ‚îú‚îÄ‚îÄ rateLimiter.ts   // Request rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ validator.ts     // Input validation
‚îÇ   ‚îî‚îÄ‚îÄ cors.ts          // CORS configuration
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts          // Authentication endpoints
‚îÇ   ‚îú‚îÄ‚îÄ collection.ts    // Collection management
‚îÇ   ‚îú‚îÄ‚îÄ wishlist.ts      // Wishlist operations
‚îÇ   ‚îú‚îÄ‚îÄ scouting.ts      // Scout results & alerts
‚îÇ   ‚îî‚îÄ‚îÄ dashboard.ts     // Analytics & reporting
‚îî‚îÄ‚îÄ app.ts               // Express app configuration

2. Business Logic Layer
TypeScript

// Service layer organization
services/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.ts           // User authentication
‚îÇ   ‚îî‚îÄ‚îÄ PermissionService.ts     // Authorization logic
‚îú‚îÄ‚îÄ collection/
‚îÇ   ‚îú‚îÄ‚îÄ CollectionService.ts     // Collection management
‚îÇ   ‚îî‚îÄ‚îÄ WishlistService.ts       // Wishlist operations
‚îú‚îÄ‚îÄ scouting/
‚îÇ   ‚îú‚îÄ‚îÄ ScoutingEngine.ts        // eBay polling system
‚îÇ   ‚îú‚îÄ‚îÄ DealScorer.ts            // Deal ranking algorithm
‚îÇ   ‚îî‚îÄ‚îÄ AlertService.ts          // Alert generation
‚îú‚îÄ‚îÄ gamification/
‚îÇ   ‚îú‚îÄ‚îÄ TrophyEngine.ts          // Achievement system
‚îÇ   ‚îî‚îÄ‚îÄ GoalTracker.ts           // Collection goals
‚îî‚îÄ‚îÄ external/
    ‚îú‚îÄ‚îÄ EbayClient.ts            // eBay API integration
    ‚îú‚îÄ‚îÄ GoCollectClient.ts       // Market data API
    ‚îî‚îÄ‚îÄ ResendClient.ts          // Email service
    
3. Data Access Layer
TypeScript

// Database interaction layer
data/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ User.ts              // User entity
‚îÇ   ‚îú‚îÄ‚îÄ Comic.ts             // Comic entity
‚îÇ   ‚îú‚îÄ‚îÄ Collection.ts        // User collection
‚îÇ   ‚îú‚îÄ‚îÄ Wishlist.ts          // Wishlist items
‚îÇ   ‚îú‚îÄ‚îÄ Alert.ts             // Alert settings
‚îÇ   ‚îî‚îÄ‚îÄ Trophy.ts            // Achievement system
‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îú‚îÄ‚îÄ UserRepository.ts    // User data operations
‚îÇ   ‚îú‚îÄ‚îÄ ComicRepository.ts   // Comic data operations
‚îÇ   ‚îî‚îÄ‚îÄ CollectionRepository.ts
‚îî‚îÄ‚îÄ migrations/
    ‚îú‚îÄ‚îÄ 001_initial_schema.sql
    ‚îú‚îÄ‚îÄ 002_add_trophies.sql
    ‚îî‚îÄ‚îÄ 003_alert_system.sql
    
üîÑ Data Flow Architecture
1. Request Processing Flow
Code snippet

graph TD
    A[Client Request] --> B[API Gateway]
    B --> C[Authentication Middleware]
    C --> D[Validation Middleware]
    D --> E[Rate Limiting]
    E --> F[Route Handler]
    F --> G[Service Layer]
    G --> H[Data Repository]
    H --> I[Supabase Database]
    I --> H
    H --> G
    G --> F
    F --> J[JSON Response]
    J --> A
    
2. Scouting Engine Flow
Code snippet

graph TD
    A[Cron Scheduler] --> B[Scouting Engine]
    B --> C[Fetch Active Wishlists]
    C --> D[Query eBay API]
    D --> E[Match Listings to Wants]
    E --> F[Calculate Deal Scores]
    F --> G[Generate Alerts]
    G --> H[Send Notifications]
    H --> I[Update Alert History]
    
3. Alert System Flow
Code snippet

graph TD
    A[Alert Trigger] --> B[Alert Service]
    B --> C[Check User Preferences]
    C --> D[Validate Alert Conditions]
    D --> E[Generate Alert Message]
    E --> F[Queue Email Notification]
    F --> G[Send via Resend API]
    G --> H[Log Alert Delivery]
    
üóÑÔ∏è Database Architecture
Entity Relationship Diagram
SQL

-- Core Entities
Users ||--o{ User_Collection : owns
Users ||--o{ Wishlist_Items : wants
Users ||--o{ Alert_Settings : configures
Users ||--o{ User_Trophies : earned

Comics ||--o{ User_Collection : collected
Comics ||--o{ Wishlist_Items : wanted

Trophies ||--o{ User_Trophies : awarded

-- Relationships
User_Collection }o--|| Comics : contains
Wishlist_Items }o--|| Comics : references
Alert_Settings }o--o| Wishlist_Items : monitors

Indexing Strategy
SQL

-- Performance-critical indexes
CREATE INDEX idx_user_collection_user_id ON User_Collection(user_id);
CREATE INDEX idx_wishlist_user_id ON Wishlist_Items(user_id);
CREATE INDEX idx_comics_title_issue ON Comics(title, issue_number);
CREATE INDEX idx_alert_settings_active ON Alert_Settings(is_active, user_id);

üîí Security Architecture
Authentication Flow
User Registration/Login ‚Üí Supabase Auth

JWT Token Generation ‚Üí Supabase returns signed JWT

Request Authentication ‚Üí Validate JWT on each API call

Authorization Check ‚Üí Verify user permissions for resources

Security Layers
TypeScript

// Security middleware stack
app.use(helmet());               // Security headers
app.use(cors(corsOptions));      // CORS configuration
app.use(rateLimiter);            // Rate limiting
app.use(authMiddleware);         // JWT validation
app.use(rbacMiddleware);         // Role-based access control

Data Protection
Encryption at Rest: Supabase managed encryption

Encryption in Transit: HTTPS/TLS for all communications

Input Sanitization: Joi/Zod schema validation

SQL Injection Prevention: Parameterized queries via Supabase-js

üìà Scalability Considerations
Horizontal Scaling
Stateless API Design: No server-side session storage

Database Connection Pooling: Efficient connection management

Caching Strategy: Redis for frequently accessed data

CDN Integration: Static asset delivery optimization

Performance Optimization
Response Caching: HTTP cache headers for static data

Database Query Optimization: Indexed queries and query analysis

Background Job Processing: Queue-based alert processing

API Response Compression: Gzip compression for large responses


üîß Development Environment
Local Setup Architecture
YAML

# Docker Compose Development Stack
version: '3.8'
services:
  api:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
  
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=comicscout_dev
    ports:
      - "5432:5432"
  
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
Testing Architecture
Unit Tests: Jest + TypeScript

Integration Tests: Supertest for API endpoints

Database Tests: Test database with migrations

E2E Tests: Playwright for full user scenarios

üöÄ Deployment Architecture
Production Environment
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Load Balancer ‚îÇ    ‚îÇ  API Instances  ‚îÇ    ‚îÇ    Database     ‚îÇ
‚îÇ                 ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                 ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                 ‚îÇ
‚îÇ  ‚Ä¢ SSL Term     ‚îÇ    ‚îÇ ‚Ä¢ Node.js Apps  ‚îÇ    ‚îÇ ‚Ä¢ Supabase      ‚îÇ
‚îÇ  ‚Ä¢ Rate Limit   ‚îÇ    ‚îÇ ‚Ä¢ Auto Scaling  ‚îÇ    ‚îÇ ‚Ä¢ Backups       ‚îÇ
‚îÇ  ‚Ä¢ Health Check ‚îÇ    ‚îÇ ‚Ä¢ Health Checks ‚îÇ    ‚îÇ ‚Ä¢ Monitoring    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Monitoring & Observability
Application Metrics: Custom metrics for business KPIs

Error Tracking: Structured logging and error aggregation

Performance Monitoring: API response time tracking

Uptime Monitoring: Health check endpoints and alerts

üîÑ Integration Patterns
External API Integration
TypeScript

// Circuit breaker pattern for external APIs
class EbayClient {
  private circuitBreaker = new CircuitBreaker(this.makeRequest, {
    timeout: 5000,
    errorThresholdPercentage: 50,
    resetTimeout: 30000
  });

  async searchListings(query: SearchQuery): Promise<ListingResult[]> {
    return this.circuitBreaker.fire(query);
  }
}
Event-Driven Architecture
TypeScript

// Event system for decoupled components
enum EventType {
  COMIC_ADDED = 'comic.added',
  DEAL_FOUND = 'deal.found',
  TROPHY_EARNED = 'trophy.earned'
}

EventEmitter.on(EventType.COMIC_ADDED, async (event) => {
  await TrophyEngine.checkAchievements(event.userId);
});
üìã API Design Standards
RESTful Conventions
GET    /api/collection/{userId}           # Get user collection
POST   /api/collection                    # Add comic to collection
PUT    /api/collection/{entryId}          # Update collection entry
DELETE /api/collection/{entryId}          # Remove from collection

GET    /api/scout/{wantId}                # Get scout results
GET    /api/dashboard/{userId}            # Get dashboard data
POST   /api/alerts                        # Create alert setting
Response Format Standards
TypeScript

// Standardized API response format
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  metadata?: {
    total?: number;
    page?: number;
    limit?: number;
  };
}
This architecture provides a solid foundation for building a scalable, maintainable, and secure comic collection and scouting platform that can grow with user demand and feature requirements.